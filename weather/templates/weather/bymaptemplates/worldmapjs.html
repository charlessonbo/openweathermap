<script>
    $(document).ready(function() {
        set_world_map()
    });

    function set_world_map(){
        var map = L.map('map').setView([0,0],1)

        L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=iokfUVv9rgeWKrI9Vng4', 
        { 
            attribution: `<a href="https://www.maptiler.com/copyright/" 
                        target="_blank">&copy; MapTiler</a> 
                        
                        <a href="https://www.openstreetmap.org/copyright" 
                        target="_blank">
                        &copy; OpenStreetMap contributors
                        </a>`
        }).addTo(map)
    

        map.on('click', function(event){
            var latitude = to_two_decimal(String(event.latlng.lat)),
            longitude = to_two_decimal(String(event.latlng.lng));

            get_weather_forecast(latitude,longitude)


            var message = "Latitude:"+ latitude + " " + "Longitude:"+ longitude
            add_pop_up_message_on_map(event, map, message)
    
    
        });
    }


    function to_two_decimal(string_var){
        return parseFloat(string_var).toFixed(2)
    }


    function add_pop_up_message_on_map(event, map, message){
        var popup = L.popup()
        .setLatLng(event.latlng)
        .setContent(message)
        .openOn(map);
    }


    function get_weather_forecast(latitude,longitude){
        $.ajax({
            type: 'GET',
            url: "{% url 'get_weather_by_coordinates' %}",
            data: {
                "latitude": latitude, 
                "longitude": longitude
            },
            success: function (response) {
                console.log(response)
            }
        })
    }
</script>